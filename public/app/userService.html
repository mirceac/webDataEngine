<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../components/iron-list/iron-list.html">
<link rel="import" href="../components/iron-dropdown/iron-dropdown.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<link rel="import" href="../components/paper-input/paper-input.html">
<link rel="import" href="../components/paper-listbox/paper-listbox.html">
<link rel="import" href="../components/paper-item/paper-item.html">
<link rel="import" href="../components/iron-collapse/iron-collapse.html">
<style>
    .item {
       @apply(--layout-horizontal);
       padding: 5px;
       border-radius: 8px;
       background-color: lightblue;
       border: 2px solid #ddd;
    }
    paper-button.colored {
       color: black;
       background: lightgreen;
    }
    .horizontal-section {
       padding: 0 !important;
    }
    paper-item {
       --paper-item: {
         cursor: pointer;
      };
    }
    .sublist {
        padding-left: 10px;
        padding-right: 10px;
    }
</style>
<dom-module id="user-service">
    <style>
        :host {
            display:block;
        }
    </style>
    <template>
        <iron-ajax
                id="addUserAction"
                url="/api/users/add"
                method="POST"
                content-type="application/json"
                on-response="userAdded"
                handle-as="json">
        </iron-ajax>

        <iron-ajax
                id="listUsersAction"
                url="/api/users/list"
                last-response="{{data}}"
                auto>
        </iron-ajax>

        <paper-input id="userName" label="Your user name"></paper-input>
        <paper-input id="password" label="Your password" type="password"></paper-input>

        <div class="horizontal-section">
            <paper-listbox id="role" multi>
                <paper-item value = "ROLE_ADMIN">ROLE_ADMIN</paper-item>
                <paper-item value = "ROLE_USER">ROLE_USER</paper-item>
            </paper-listbox>
        </div>

        <paper-button id="create" raised class="colored">Create</paper-button>
        <p>Users</p>
        <iron-list items="[[data]]" as="item">
            <template>
                <div class="item">
                    User Name: <span>[[item.userName]]</span>
                </div>
            </template>
        </iron-list>
    </template>
</dom-module>
<script>
    Polymer({
       is: "user-service",
       addNew: function(user) {
         this.$.addUserAction.body=JSON.stringify(user);
         this.$.addUserAction.generateRequest();
       },
       userAdded: function() {
         this.$.listUsersAction.generateRequest();
       }
    });
    // To ensure that elements are ready on polyfilled browsers,
    // wait for WebComponentsReady.
    document.addEventListener('WebComponentsReady', function() {
      var userNameInput = document.getElementById("userName");
      var passwordInput = document.getElementById("password");
      var role = document.getElementById("role");
      var button = document.getElementById("create");
      var user = {}
      button.addEventListener('click', function() {
        user["userName"] = userNameInput.value;
        user["password"] = passwordInput.value;
        var selectedRoles = role.selectedItems;
        var selectedValues = [];
        var i;
        if (selectedRoles != undefined) {
            for (i=0;i<selectedRoles.length; i++) {
                selectedValues[i]=selectedRoles[i].getAttribute("value");
            }
        }
        user["roles"] = selectedValues
        var userService = document.getElementById("userService");
        userService.addNew(user);
      });
    })
</script>