<link rel="import" href="../components/polymer/polymer.html">
<link rel="import" href="../components/iron-ajax/iron-ajax.html">
<link rel="import" href="../components/iron-list/iron-list.html">
<link rel="import" href="../components/paper-button/paper-button.html">
<link rel="import" href="../components/paper-input/paper-input.html">
<style>
    .item {
       @apply(--layout-horizontal);
       padding: 5px;
       border-radius: 8px;
       background-color: lightblue;
       border: 2px solid #ddd;
    }
    paper-button.colored {
    color: black;
    background: lightgreen;
    }
</style>
<dom-module id="user-service">
    <style>

    </style>
    <template>
        <iron-ajax
                id="addUserAction"
                url="/api/users/add"
                method="POST"
                content-type="application/json"
                on-response="userAdded"
                handle-as="json">
        </iron-ajax>

        <iron-ajax
                id="listUsersAction"
                url="/api/users/list"
                last-response="{{data}}"
                auto>
        </iron-ajax>

        <paper-input id="userName" label="Your user name"></paper-input>
        <paper-input id="password" label="Your password" type="password"></paper-input>
        <paper-button id="create" raised class="colored">Create</paper-button>
        <p>Users</p>
        <iron-list items="[[data]]" as="item">
            <template>
                <div class="item">
                    User Name: <span>[[item.userName]]</span>
                </div>
            </template>
        </iron-list>
    </template>
</dom-module>
<script>
    Polymer({
       is: "user-service",
       addNew: function(user) {
         this.$.addUserAction.body=JSON.stringify(user);
         this.$.addUserAction.generateRequest();
       },
       userAdded: function() {
         this.$.listUsersAction.generateRequest();
       }
    });
    // To ensure that elements are ready on polyfilled browsers,
    // wait for WebComponentsReady.
    document.addEventListener('WebComponentsReady', function() {
      var userNameInput = document.getElementById("userName");
      var passwordInput = document.getElementById("password");
      var button = document.getElementById("create");
      var user = {}
      button.addEventListener('click', function() {
        user["userName"] = userNameInput.value;
        user["password"] = passwordInput.value;
        var userService = document.getElementById("userService");
        userService.addNew(user);
      });
    })
</script>